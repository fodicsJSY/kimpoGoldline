<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="normalMapper">


	<resultMap type="fodics.jsy.dashboard.main.model.dto.Main" id="_main">
      	<result property="occuTime" column="occu_time" />
      	<result property="roleCode" column="role_code" />
      	<result property="eventType" column="event_type" />
      	<result property="eventStatus" column="event_status" />
      	<result property="occuHour" column="OCCU_HOUR" />
      	<result property="gimpoIn24" column="GIMPO_IN_24" />
      	<result property="gimpoOut24" column="GIMPO_OUT_24" />
      	<result property="gochon24" column="GOCHON24" />
      	<result property="pungmu24" column="PUNGMU24" />
      	<result property="gimpoIn24Count" column="GIMPO_IN_24COUNT" />
      	<result property="gimpoOut24Count" column="GIMPO_OUT_24COUNT" />
      	<result property="gochon24Count" column="GOCHON24COUNT" />
      	<result property="gochon1_24Count" column="GOCHON1_24COUNT" />
      	<result property="gochon2_24Count" column="GOCHON2_24COUNT" />
      	<result property="pungmu24Count" column="PUNGMU24COUNT" />
      	<result property="gimpoIn24Change" column="GIMPO_IN_24CHANGE" />
      	<result property="gimpoOut24Change" column="GIMPO_OUT_24CHANGE" />
      	<result property="gochon24Change" column="GOCHON24CHANGE" />
      	<result property="pungmu24Change" column="PUNGMU24CHANGE" />
      	<result property="gimpoIn24ChangeCount" column="GIMPO_IN_24_CHANGE_COUNT" />
      	<result property="gimpoOut24ChangeCount" column="GIMPO_OUT_24_CHANGE_COUNT" />
      	<result property="gochon24ChangeCount" column="GOCHON24_CHANGE_COUNT" />
      	<result property="gochon1_24ChangeCount" column="GOCHON1_24_CHANGE_COUNT" />
      	<result property="gochon2_24ChangeCount" column="GOCHON2_24_CHANGE_COUNT" />
      	<result property="pungmu24ChangeCount" column="PUNGMU24_CHANGE_COUNT" />
      	<result property="objectClass" column="object_class" />
	</resultMap> 
  
  <resultMap id="_int" type="java.lang.Integer"/>
  
  
  
  <!-- 24시간 김포공항역, 고촌역, 풍무역 승하차 수 -->
  <select id="normal24CountList" resultMap="_main">
  	SELECT
	    SUBSTRING(H.OCCU_TIME, 9, 2) AS OCCU_HOUR,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS kimpoIn24,
	    COUNT(CASE WHEN H.event_status = '-1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS kimpoOut24,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-플랫폼1-출근', '고촌-플랫폼2-출근', '고촌-플랫폼3-출근', '고촌-플랫폼4-출근') THEN 1 END) AS gochon24,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('풍무-플랫폼1-출근', '풍무-플랫폼2-출근', '풍무-플랫폼3-출근', '풍무-플랫폼4-출근') THEN 1 END) AS pungmu24
	FROM TB_EVENT_HIST_DL H
	JOIN TB_EVENT_ROLE_DL R ON H.role_code = R.role_code
	WHERE SUBSTRING(H.OCCU_TIME, 1, 8) = CONVERT(varchar, GETDATE(), 112)
	GROUP BY SUBSTRING(H.OCCU_TIME, 9, 2)
  </select>
  
  
  
  
  <!-- 24시간 김포공항역, 고촌역, 풍무역 승하차 누적 수 -->
  <select id="total24Count" resultMap="_main">
  	SELECT
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS GIMPO_IN_24COUNT,
	    COUNT(CASE WHEN H.event_status = '-1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS GIMPO_OUT_24COUNT,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-플랫폼1-출근', '고촌-플랫폼2-출근', '고촌-플랫폼3-출근', '고촌-플랫폼4-출근') THEN 1 END) AS GOCHON24COUNT,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-역사입구1') THEN 1 END) AS GOCHON1_24COUNT,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-역사입구2') THEN 1 END) AS GOCHON2_24COUNT,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('풍무-플랫폼1-출근', '풍무-플랫폼2-출근', '풍무-플랫폼3-출근', '풍무-플랫폼4-출근') THEN 1 END) AS PUNGMU24COUNT
	FROM TB_EVENT_HIST_DL H
	JOIN TB_EVENT_ROLE_DL R ON H.role_code = R.role_code
	WHERE SUBSTRING(H.OCCU_TIME, 1, 8) = CONVERT(varchar, GETDATE(), 112)
  </select>
  
  
  
    <!-- 24시간 김포공항역, 고촌역, 풍무역 승하차 수(날짜변경 시) -->
  <select id="normalDateChangeList" resultMap="_main">
	SELECT
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS GIMPO_IN_24CHANGE,
	    COUNT(CASE WHEN H.event_status = '-1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS GIMPO_OUT_24CHANGE,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-플랫폼1-출근', '고촌-플랫폼2-출근', '고촌-플랫폼3-출근', '고촌-플랫폼4-출근') THEN 1 END) AS GOCHON24CHANGE,
	    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('풍무-플랫폼1-출근', '풍무-플랫폼2-출근', '풍무-플랫폼3-출근', '풍무-플랫폼4-출근') THEN 1 END) AS PUNGMU24CHANGE
	FROM TB_EVENT_HIST_DL H
	JOIN TB_EVENT_ROLE_DL R ON H.role_code = R.role_code
	WHERE SUBSTRING(H.OCCU_TIME, 1, 8) = #{occuDate}
	GROUP BY SUBSTRING(H.OCCU_TIME, 9, 2)
  </select>
  
  
  
  <!-- 24시간 김포공항역, 고촌역, 풍무역 누적 수(날짜변경 시) -->
  <select id="normalDateChangeCount" resultMap="_main">
  	   SELECT
		    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근' ) THEN 1 END) AS GIMPO_IN_24_CHANGE_COUNT,
		    COUNT(CASE WHEN H.event_status = '-1' AND R.role_name IN ('김포-EC-출근', '김포-ST-출근', '김포-EV-출근') THEN 1 END) AS GIMPO_OUT_24_CHANGE_COUNT,
		    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-플랫폼1-출근', '고촌-플랫폼2-출근', '고촌-플랫폼3-출근', '고촌-플랫폼4-출근') THEN 1 END) AS GOCHON24_CHANGE_COUNT,
		    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-역사입구1') THEN 1 END) AS GOCHON1_24_CHANGE_COUNT,
		    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('고촌-역사입구2') THEN 1 END) AS GOCHON2_24_CHANGE_COUNT,
		    COUNT(CASE WHEN H.event_status = '1' AND R.role_name IN ('풍무-플랫폼1-출근', '풍무-플랫폼2-출근', '풍무-플랫폼3-출근', '풍무-플랫폼4-출근') THEN 1 END) AS PUNGMU24_CHANGE_COUNT
		FROM TB_EVENT_HIST_DL H
		JOIN TB_EVENT_ROLE_DL R ON H.role_code = R.role_code
		WHERE SUBSTRING(H.OCCU_TIME, 1, 8) = #{occuDate}
  </select>


</mapper>